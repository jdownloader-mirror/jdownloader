<project default="standardBuild" basedir=".">
    <property environment="env"/>
    <property name="src" value="src" />
    <property name="cls" value="bin" />
    <property name="dist" value="dist" />
    <property name="res" value="ressourcen" />
	<property name="keystore" value="G:\jdworkspace\jDownloader.keystore" />
	<property name="class-path" value="libs/BrowserLauncher2.jar libs/js.jar libs/swingx.jar libs/servlet-api-2.5-6.1.8.jar libs/servlet-api-2.5-6.1.8.jar libs/jetty-6.1.8.jar libs/jetty-util-6.1.8.jar libs/jl1.0.jar" />
    <target name="compile">
        <javac srcdir="${src}" destdir="${cls}" encoding="UTF-8" source="1.5" />
    </target>

    <target name="jar">
        <!-- jDownloader -->
        <manifest file="Manifest.MF">
            <attribute name="Created-By" value="coalado" />
            <attribute name="Main-Class" value="jd.Main" />
			<attribute name="Class-Path" value="${class-path}" />		
        </manifest>
        <jar jarfile="${dist}/JDownloader.jar" manifest="Manifest.MF">
            <fileset dir="${cls}">
                <include name="**/*.class" />                
                <exclude name="jd/plugins/decrypt/**" />
                <exclude name="jd/plugins/host/**" />
                <exclude name="jd/plugins/container/**" />
                <exclude name="jd/plugins/optional/**" />
            </fileset>
            <fileset dir="${res}">                
                <include name="*.properties" />
                <exclude name="jd/captcha/methods" />
            </fileset>
        </jar>
    	<delete file="Manifest.MF" failonerror="false" />
        <!-- Plugins -->
        <manifest file="Manifest.MF">
              <attribute name="Created-By" value="coalado" />           
  			<attribute name="Class-Path" value="${class-path}" />		
          </manifest>
        <jar jarfile="${dist}/JDownloaderPlugins.jar" manifest="Manifest.MF">
            <fileset dir="${cls}">
                <include name="jd/plugins/decrypt/**" />
                <include name="jd/plugins/host/**" />
            </fileset>
            <fileset dir="${res}">
                <include name="META-INF/services/*" />
                <exclude name="META-INF/services/jd.plugins.PluginForContainer" />
                <exclude name="META-INF/services/jd.plugins.PluginOptional" />
            </fileset>
        </jar>
	</target>
	<target name="jarWebupdater">
		<!--Webupdater-->	
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.update.Main" />
	    </manifest>
		<jar jarfile="${dist}/webupdater.jar" manifest="Manifest.MF">
		    <fileset dir="${cls}">
		        <include name="jd/update/*.class" />    
				<include name="jd/utils/HTMLEntities.class" /> 				
		    </fileset>       
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>
		
	<target name="jarOptionals">	
		<!-- Optional Plugins -->	
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.update.Main" />
		
	    </manifest>
        <jar jarfile="${dist}/JDLightTray.jar" manifest="Manifest.MF">
            <fileset dir="${cls}">
                <include name="jd/plugins/optional/JDLightTray*" />    
            	<include name="jd/plugins/optional/TrayIconPopup*" />   
            	
            </fileset>
			     <fileset dir="${res}">
                <include name="META-INF/services/jd.plugins.PluginOptional" />
            </fileset>
        </jar>
		<delete file="Manifest.MF" failonerror="false" />
		
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="Botzi" />
			<attribute name="Main-Class" value="jd.update.Main" />
	    </manifest>
        <jar jarfile="${dist}/JDTrayIcon.jar" manifest="Manifest.MF">
            <fileset dir="${cls}">
                <include name="jd/plugins/optional/JDTrayIcon*" />                
              </fileset>
			     <fileset dir="${res}">
                <include name="META-INF/services/jd.plugins.PluginOptional" />
            </fileset>
        </jar>
		<delete file="Manifest.MF" failonerror="false" />
		
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="Botzi" />
			<attribute name="Main-Class" value="jd.update.Main" />
	    </manifest>
        <jar jarfile="${dist}/JDGetter.jar" manifest="Manifest.MF">
            <fileset dir="${cls}">
                <include name="jd/plugins/optional/JDGetter*" />                
              </fileset>
			     <fileset dir="${res}">
                <include name="META-INF/services/jd.plugins.PluginOptional" />
            </fileset>
        </jar>
		<delete file="Manifest.MF" failonerror="false" />
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="Tudels" />
			<attribute name="Main-Class" value="jd.update.Main" />
	    </manifest>
        <jar jarfile="${dist}/schedule.jar" manifest="Manifest.MF">
            <fileset dir="${cls}">
                <include name="jd/plugins/optional/schedule/**" />                
              </fileset>
			     <fileset dir="${res}">
                <include name="META-INF/services/jd.plugins.PluginOptional" />
            </fileset>
        </jar>
		<delete file="Manifest.MF" failonerror="false" />			
			<manifest file="Manifest.MF">
				<attribute name="Created-By" value="jiaz" />
				<attribute name="Main-Class" value="jd.update.Main" />
		    </manifest>
	        <jar jarfile="${dist}/JDWebinterface.jar" manifest="Manifest.MF">
	            <fileset dir="${cls}">
	                <include name="jd/plugins/optional/webinterface/**" />        
	            </fileset>
				     <fileset dir="${res}">
	                <include name="META-INF/services/jd.plugins.PluginOptional" />
	            </fileset>
	        </jar>
			<delete file="Manifest.MF" failonerror="false" />
		
		<manifest file="Manifest.MF">
				<attribute name="Created-By" value="Scr4ve" />
				<attribute name="Main-Class" value="jd.update.Main" />
		    </manifest>
	        <jar jarfile="${dist}/JDRemoteControl.jar" manifest="Manifest.MF">
	            <fileset dir="${cls}">
	                <include name="jd/plugins/optional/JDRemoteControl*" />                
	              </fileset>
				     <fileset dir="${res}">
	                <include name="META-INF/services/jd.plugins.PluginOptional" />
	            </fileset>
	        </jar>
		
		
		<manifest file="Manifest.MF">
				<attribute name="Created-By" value="JD-Team" />
				<attribute name="Main-Class" value="jd.update.Main" />
		    </manifest>
	        <jar jarfile="${dist}/JDShutdown.jar" manifest="Manifest.MF">
	            <fileset dir="${cls}">
	                <include name="jd/plugins/optional/JDShutdown*" />                
	              </fileset>
				 
	        </jar>
		
    </target>
	<target name="jarContainer">
		<!-- Container -->
		<jar jarfile="${dist}/JDownloaderContainer.jar">
			<fileset dir="${cls}">
				<include name="jd/plugins/Plugin.class" />
				<include name="jd/plugins/PluginForDecrypt.class" />
                <include name="jd/plugins/PluginForContainer.class" />
				<include name="jd/plugins/container/**/*" />
			</fileset>
			<fileset dir="${res}">
                <include name="META-INF/services/jd.plugins.PluginForContainer" />
            </fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>
    <target name="sign">
        <signjar keystore="${keystore}" alias="jDownloader" storepass="jDownloader">
            <path>
                <fileset dir="${dist}" includes="*.jar" />
            </path>
        </signjar>
    </target>
	<target name="cryptContainer">
		<taskdef name="yguard"  classname="com.yworks.yguard.YGuardTask"/>
		<yguard>
			<inoutpair in="${dist}/JDownloaderContainer.jar" out="${dist}/JDownloaderContainer_obfuscated.jar" />
			<rename>
				<keep>
					<class extends="jd.plugins.Plugin"   />
                    <class extends="jd.plugins.PluginForContainer"/>
					<class classes="protected" methods="protected" fields="protected"/>
					<class classes="public" methods="public" fields="public"/>
				</keep>
			</rename>
		</yguard>
		<delete file="${dist}/JDownloaderContainer.jar" failonerror="no" />
		<move file="${dist}/JDownloaderContainer_obfuscated.jar" tofile="${dist}/JDownloaderContainer.jar" />
	</target>
	<target name="standardBuild" depends="compile,jar,jarOptionals,jarWebupdater"></target>
	<target name="dlcEnabledBuild" depends="standardBuild,jarContainer,cryptContainer,sign"></target>
	<target name="signedBuild" depends="standardBuild,sign"></target>
</project>
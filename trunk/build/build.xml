<project default="standardBuild" basedir=".">
	<property environment="env" />
	<property name="src" value="src" />
	<property name="cls" value="bin" />
	<property name="dist" value="dist" />
	<property name="res" value="ressourcen" />
	<property name="keystore" value="G:\jDownloader.keystore" />
	<property name="class-path" value="libs/clink170.jar libs/svnkit.jar libs/mail.jar libs/htmlcleaner2_0.jar libs/hsqldb.jar libs/miglayout15-swing.jar libs/irclib.jar libs/BrowserLauncher2.jar libs/js.jar libs/swingx.jar libs/jl1.0.jar libs/savemytube.jar" />
	<target name="compile">
		<javac srcdir="${src}" destdir="${cls}" encoding="UTF-8" source="1.5" />
	</target>

	<target name="jar">
		<!-- jDownloader -->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.Main" />
			<attribute name="Class-Path" value="${class-path}" />
		</manifest>
		<jar jarfile="${dist}/JDownloader.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="**/*.class" />
				<exclude name="jd/plugins/decrypt/**" />
				<exclude name="jd/plugins/host/**" />
				<exclude name="jd/captcha/methods/**" />
				<exclude name="jd/plugins/optional/**" />
				<include name="jd/plugins/host/HTTPAllgemein*" />
			</fileset>
			<fileset dir="${res}">
				<include name="*.properties" />
				<exclude name="jd/captcha/methods" />
			</fileset>
		</jar>	

	</target>
	<target name="jarWebupdater">
		<!--Webupdater-->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.update.Main" />
		</manifest>
		<jar jarfile="${dist}/webupdater.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/update/*.class" />
				<include name="jd/utils/HTMLEntities.class" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>

	<target name="jarOptionals">
		<!-- Optional Plugins -->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team" />
		</manifest>

		<jar jarfile="${dist}/pluginressourcen/108__JDTrayLight/plugins/JDLightTray.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDLightTray*" />
				<include name="jd/plugins/optional/TrayIconPopup*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/107__JDTrayIcon/plugins/JDTrayIcon.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDTrayIcon*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/105__JDScheduler/plugins/schedule.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/schedule/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/101__JDwebinterface/plugins/JDWebinterface.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/webinterface/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/100__JDChat/plugins/JDChat.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdchat/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/104__JDRemoteControl/plugins/JDRemoteControl.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDRemoteControl*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/119__JDNewsfeed/plugins/JDNewsfeeds.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/Newsfeeds*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/118__JDLowSpeed/plugins/JDLowSpeed.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDLowSpeed*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/117__JDHttpLiveScripter/plugins/JDHTTPLiveHeaderScripter.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/HTTPLiveHeaderScripter*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/120__JDLangFileEditor/plugins/JDLangFileEditor.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/LangFileEditor*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/123__JDUnrar/plugins/JDUnrar.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdunrar/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/127__JDHJMerge/plugins/JDHJMerge.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/hjsplit/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/122__JDInfoFileWriter/plugins/JDInfoFileWriter.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDInfoFileWriter*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/121__JDWatchFolder/plugins/JDFolderWatch.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDFolderWatch*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/106__JDShutdown/plugins/JDShutdown.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDShutdown*" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/pluginressourcen/125__JDPremiumCollect/plugins/JDPremiumCollect.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDPremiumCollector*" />
			</fileset>
		</jar>
	</target>

	<target name="sign">
		<signjar keystore="${keystore}" alias="jDownloader" storepass="jDownloader">
			<path>
				<fileset dir="${dist}" includes="*.jar" />
			</path>
		</signjar>
	</target>
	<target name="cryptContainer">
		<taskdef name="yguard" classname="com.yworks.yguard.YGuardTask" />
		<yguard>
			<inoutpair in="${dist}/JDownloader.jar" out="${dist}/JDownloader_obfuscated.jar" />
			<rename>
				<keep>
					<field name="serialVersionUID" />
					<method name="void readObject(java.io.ObjectInputStream)" />
					<method name="void writeObject(java.io.ObjectOutputStream)" />

					<class implements="java.io.Serializable" classes="private" methods="private" fields="private" />

					<class extends="jd.plugins.Plugin" />
					<class classes="protected" methods="protected" fields="protected" />
					<class classes="public" methods="public" fields="public" />
				</keep>
			</rename>
		</yguard>
		<delete file="${dist}/JDownloader.jar" failonerror="no" />
		<move file="${dist}/JDownloader_obfuscated.jar" tofile="${dist}/JDownloader.jar" />
	</target>
	<target name="standardBuild" depends="compile,jar,jarOptionals,jarWebupdater">
	</target>
	<target name="dlcEnabledBuild" depends="standardBuild,cryptContainer,sign">
	</target>
	<target name="signedBuild" depends="standardBuild,sign">
	</target>
</project>
<project default="standardBuild" basedir=".">
	<property environment="env" />
	<property name="src" value="src" />
	<property name="cls" value="bin" />
	<property name="dist" value="dist" />
	<property name="res" value="ressourcen" />
	<property name="keystore" value="G:\jDownloader.keystore" />
	<property name="class-path" value="libs/JUnique.jar libs/JDGUI.jar libs/JDHttp.jar libs/JAntiCaptcha.jar libs/JDUtils.jar libs/balloontip.jar libs/BrowserLauncher2.jar libs/clink170.jar libs/cobra.jar libs/hsqldb.jar libs/htmlcleaner2_0.jar libs/irclib.jar libs/jl1.0.jar libs/js.jar libs/looks.jar libs/mail.jar libs/miglayout.jar libs/registry.jar libs/savemytube.jar libs/substance-swingx.jar libs/substance.jar libs/svnkit.jar libs/swingworker.jar libs/swingx.jar libs/synthetica.jar libs/syntheticaAddons.jar libs/syntheticaBlackMoon.jar libs/syntheticaBlackStar.jar libs/syntheticaBlueIce.jar libs/syntheticaBlueMoon.jar libs/syntheticaOrangeMetallic.jar libs/syntheticaSilverMoon.jar libs/syntheticaSimple2D.jar libs/syntheticaSkyMetallic.jar libs/syntheticaWhiteVision.jar" />
	<target name="compile">
		<mkdir dir="${cls}" />
		<javac srcdir="${src}" destdir="${cls}" encoding="UTF-8" source="1.5" />
	</target>

	<target name="jar">
		<!-- jDownloader -->
		<mkdir dir="${dist}" />
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team and AppWork UG" />
			<attribute name="Main-Class" value="jd.Main" />
			<attribute name="Class-Path" value="${class-path}" />
		</manifest>
		<jar jarfile="${dist}/JDownloader.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="**/*.class" />
				<exclude name="jd/http/**" />
				<exclude name="jd/captcha/**" />
				<exclude name="jd/gui/**" />
				<exclude name="it/**" />				
				<exclude name="jd/plugins/host/**" />
				<exclude name="jd/plugins/decrypt/**" />
				<exclude name="jd/captcha/methods/**" />
				<exclude name="jd/plugins/optional/**" />
				<exclude name="sun/net/www/protocol/**" />
				<include name="jd/plugins/host/HTTPAllgemein*" />
			</fileset>
			<fileset dir="${res}">
				<include name="*.properties" />
				<exclude name="jd/captcha/methods" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
			<manifest file="Manifest.MF">
				<attribute name="Created-By" value="JD-Team and AppWork UG. Copyright Sauronsoftware.it" />
				<attribute name="Class-Path" value="${class-path}" />
			</manifest>

			<mkdir dir="${dist}/libs" />
			<jar jarfile="${dist}/libs/JUnique.jar" manifest="Manifest.MF">
				<fileset dir="${cls}">
					<include name="it/**" />
					
				</fileset>
			</jar>
		<delete file="Manifest.MF" failonerror="false" />
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team and AppWork UG" />
			<attribute name="Class-Path" value="${class-path}" />
		</manifest>

		<mkdir dir="${dist}/libs" />
		<jar jarfile="${dist}/libs/JDHttp.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/http/**" />
				<include name="sun/net/www/protocol/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/libs/JDGUI.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/gui/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/libs/JAntiCaptcha.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/captcha/**" />
				<exclude name="jd/captcha/methods/**" />
			</fileset>
		
		</jar>

		<jar jarfile="${dist}/libs/JDUtils.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/nutils/**" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>

	<target name="jarWebupdater">
		<!--Webupdater-->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.update.Main" />

		</manifest>
		<jar jarfile="${dist}/jdupdate.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/update/*.class" />
				<include name="jd/config/*.class" />
				<include name="jd/http/**" />
				<include name="jd/nutils/**" />
				<include name="jd/JDClassLoader.class" />
				<include name="jd/utils/*.class" />
				<include name="jd/plugins/PluginException.class" />
				<include name="sun/net/www/protocol/jdps/*.class" />
				<include name="jd/parser/Regex.class" />
				<include name="sun/net/www/protocol/jdp/*.class" />
			</fileset>
			<zipfileset src="ressourcen/libs/hsqldb.jar" excludes="META-INF/*" />
		</jar>

		<delete file="Manifest.MF" failonerror="false" />
	</target>

	<target name="jarOptionals">
		<!-- Optional Plugins -->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team" />
		</manifest>

		<mkdir dir="${dist}/pluginressourcen/128__JDTray/plugins" />
		<jar jarfile="${dist}/pluginressourcen/128__JDTray/plugins/JDTray.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdtrayicon/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/105__JDScheduler/plugins" />
		<jar jarfile="${dist}/pluginressourcen/105__JDScheduler/plugins/schedule.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/schedule/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/101__JDwebinterface/plugins" />
		<jar jarfile="${dist}/pluginressourcen/101__JDwebinterface/plugins/JDWebinterface.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/webinterface/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/100__JDChat/plugins" />
		<jar jarfile="${dist}/pluginressourcen/100__JDChat/plugins/JDChat.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdchat/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/104__JDRemoteControl/plugins" />
		<jar jarfile="${dist}/pluginressourcen/104__JDRemoteControl/plugins/JDRemoteControl.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDRemoteControl*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/117__JDHttpLiveScripter/plugins" /> 
		<jar jarfile="${dist}/pluginressourcen/117__JDHttpLiveScripter/plugins/JDHTTPLiveHeaderScripter.jar" manifest="Manifest.MF"> 
			<fileset dir="${cls}"> 
				<include name="jd/plugins/optional/HTTPLiveHeaderScripter*" /> 
			</fileset> 
		</jar>

		<mkdir dir="${dist}/pluginressourcen/119__JDNewsfeed/plugins" />
		<jar jarfile="${dist}/pluginressourcen/119__JDNewsfeed/plugins/JDNewsfeeds.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/Newsfeeds*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/120__JDLangFileEditor/plugins" />
		<jar jarfile="${dist}/pluginressourcen/120__JDLangFileEditor/plugins/JDLangFileEditor.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/langfileeditor/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/123__JDUnrar/plugins" />
		<jar jarfile="${dist}/pluginressourcen/123__JDUnrar/plugins/JDUnrar.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdunrar/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/127__JDHJMerge/plugins" />
		<jar jarfile="${dist}/pluginressourcen/127__JDHJMerge/plugins/JDHJMerge.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/hjsplit/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/122__JDInfoFileWriter/plugins" />
		<jar jarfile="${dist}/pluginressourcen/122__JDInfoFileWriter/plugins/JDInfoFileWriter.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDInfoFileWriter*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/121__JDWatchFolder/plugins" />
		<jar jarfile="${dist}/pluginressourcen/121__JDWatchFolder/plugins/JDFolderWatch.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDFolderWatch*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/106__JDShutdown/plugins" />
		<jar jarfile="${dist}/pluginressourcen/106__JDShutdown/plugins/JDShutdown.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDShutdown*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/125__JDPremiumCollect/plugins" />
		<jar jarfile="${dist}/pluginressourcen/125__JDPremiumCollect/plugins/JDPremiumCollect.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDPremiumCollector*" />
			</fileset>
		</jar>
	</target>

	<target name="sign">
		<signjar keystore="${keystore}" alias="jDownloader" storepass="jDownloader">
			<path>
				<fileset dir="${dist}" includes="**/*.jar" />
			</path>
		</signjar>
	</target>

	<target name="cryptContainer">
		<taskdef name="yguard" classname="com.yworks.yguard.YGuardTask" />
		<yguard>
			<inoutpair in="${dist}/JDownloader.jar" out="${dist}/JDownloader_obfuscated.jar" />
			<rename>
				<keep>
					<field name="serialVersionUID" />
					<method name="void readObject(java.io.ObjectInputStream)" />
					<method name="void writeObject(java.io.ObjectOutputStream)" />

					<class implements="java.io.Serializable" classes="private" methods="private" fields="private" />

					<class extends="jd.plugins.Plugin" />
					<class classes="protected" methods="protected" fields="protected" />
					<class classes="public" methods="public" fields="public" />
				</keep>
			</rename>
		</yguard>
		<delete file="${dist}/JDownloader.jar" failonerror="no" />
		<move file="${dist}/JDownloader_obfuscated.jar" tofile="${dist}/JDownloader.jar" />
	</target>
	<target name="standardBuild" depends="compile,jar,jarOptionals,jarWebupdater">
	</target>
	<target name="dlcEnabledBuild" depends="standardBuild,cryptContainer,sign">
	</target>
	<target name="signedBuild" depends="standardBuild,sign">
	</target>
</project>